<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="/templates/user/layout.xhtml" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="jakarta.faces.facelets" xmlns:h="jakarta.faces.html" xmlns:f="jakarta.faces.core"
    xmlns:p="http://primefaces.org/ui">

    <ui:define name="content">
        <script>
            function copyVoucherCode(code, voucherId) {
                navigator.clipboard.writeText(code).then(function() {
                    // Show success message using PrimeFaces message
                    PF('voucherCopied').show();
                }, function(err) {
                    console.error('Could not copy text: ', err);
                });
            }
        </script>
        <h:form>
            <div class="flex-grow layout-container flex flex-col w-full max-w-[1280px] mx-auto px-4 lg:px-8 py-6">
                <!-- Breadcrumbs -->
                <div class="flex flex-wrap gap-2 py-4 mb-4">
                    <a class="text-[#63886f] text-sm font-medium leading-normal hover:underline" href="#">Home</a>
                    <span class="text-[#63886f] text-sm font-medium leading-normal">/</span>
                    <a class="text-[#63886f] text-sm font-medium leading-normal hover:underline" href="#">Account</a>
                    <span class="text-[#63886f] text-sm font-medium leading-normal">/</span>
                    <span class="text-[#111813] dark:text-white text-sm font-medium leading-normal">My Vouchers</span>
                </div>

                <div
                    class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-[#e5e7eb] dark:border-[#2a3e32] overflow-hidden">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h1 class="text-3xl font-bold tracking-tight text-[#0e1b12] dark:text-white mb-2">
                                    My Vouchers
                                </h1>
                                <p class="text-[#4e9767] dark:text-gray-400">
                                    View and manage your discount vouchers
                                </p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="relative">
                                    <span
                                        class="material-symbols-outlined absolute left-3 top-2.5 text-[#63886f]">search</span>
                                    <h:inputText value="#{customerVoucherMB.searchCode}"
                                        placeholder="Search voucher code"
                                        styleClass="pl-10 pr-4 py-2 rounded-lg bg-[#f0f4f2] dark:bg-[#25382c] border-transparent focus:border-primary focus:bg-white dark:focus:bg-[#1a2e22] focus:ring-0 text-[#111813] dark:text-white" />
                                </div>
                                <h:commandButton action="#{customerVoucherMB.searchVouchers}" icon="fas fa-search"
                                    styleClass="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90" />
                            </div>
                        </div>

                        <!-- Voucher Statistics -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div
                                class="bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg p-4 border border-green-200 dark:border-green-800">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-800 dark:text-green-400 text-sm font-medium">Active
                                            Vouchers</p>
                                        <p class="text-2xl font-bold text-green-900 dark:text-green-300">
                                            <h:outputText value="#{customerVoucherMB.activeVouchers.size()}" />
                                        </p>
                                    </div>
                                    <div class="p-3 bg-green-200 dark:bg-green-800 rounded-full">
                                        <span
                                            class="material-symbols-outlined text-green-700 dark:text-green-300">local_activity</span>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-800 dark:text-blue-400 text-sm font-medium">Used Vouchers
                                        </p>
                                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-300">
                                            <h:outputText value="#{customerVoucherMB.usedVouchers.size()}" />
                                        </p>
                                    </div>
                                    <div class="p-3 bg-blue-200 dark:bg-blue-800 rounded-full">
                                        <span
                                            class="material-symbols-outlined text-blue-700 dark:text-blue-300">check_circle</span>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="bg-gradient-to-r from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-lg p-4 border border-red-200 dark:border-red-800">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-red-800 dark:text-red-400 text-sm font-medium">Expired Vouchers
                                        </p>
                                        <p class="text-2xl font-bold text-red-900 dark:text-red-300">
                                            <h:outputText value="#{customerVoucherMB.expiredVouchers.size()}" />
                                        </p>
                                    </div>
                                    <div class="p-3 bg-red-200 dark:bg-red-800 rounded-full">
                                        <span
                                            class="material-symbols-outlined text-red-700 dark:text-red-300">schedule</span>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-900/20 dark:to-gray-800/20 rounded-lg p-4 border border-gray-200 dark:border-border-dark">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-800 dark:text-gray-400 text-sm font-medium">Total Vouchers
                                        </p>
                                        <p class="text-2xl font-bold text-gray-900 dark:text-gray-300">
                                            <h:outputText value="#{customerVoucherMB.myVouchers.size()}" />
                                        </p>
                                    </div>
                                    <div class="p-3 bg-gray-200 dark:bg-surface-dark rounded-full">
                                        <span
                                            class="material-symbols-outlined text-gray-700 dark:text-gray-300">inventory_2</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vouchers List -->
                        <div class="space-y-4">
                            <h:panelGroup rendered="#{empty customerVoucherMB.myVouchers}">
                                <div class="text-center py-12">
                                    <div
                                        class="w-24 h-24 bg-gray-100 dark:bg-surface-dark rounded-full flex items-center justify-center mx-auto mb-4">
                                        <span
                                            class="material-symbols-outlined text-4xl text-gray-400">local_activity</span>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No Vouchers
                                        Found</h3>
                                    <p class="text-gray-600 dark:text-gray-400">You don't have any vouchers yet. Check
                                        back later for special offers!</p>
                                </div>
                            </h:panelGroup>

                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <h:dataTable value="#{customerVoucherMB.myVouchers}" var="voucher" styleClass="w-full">
                                    <h:column>
                                        <div
                                            class="bg-white dark:bg-surface-dark rounded-lg border border-[#e5e7eb] dark:border-[#2a3e32] p-6 hover:shadow-md transition-shadow">
                                            <!-- Voucher Header -->
                                            <div class="flex items-center justify-between mb-4">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center">
                                                        <span
                                                            class="material-symbols-outlined text-primary">local_activity</span>
                                                    </div>
                                                    <div>
                                                        <h3 class="font-bold text-[#111813] dark:text-white">
                                                            <h:outputText value="#{voucher.voucherCode}" />
                                                        </h3>
                                                        <p class="text-sm text-[#63886f]">
                                                            <h:outputText value="#{voucher.offerID.offerName}" />
                                                        </p>
                                                    </div>
                                                </div>
                                                <p:badge value="#{customerVoucherMB.getVoucherStatus(voucher)}"
                                                    styleClass="badge-#{customerVoucherMB.getStatusColor(voucher)}" />
                                            </div>

                                            <!-- Voucher Details -->
                                            <div class="space-y-3">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-[#63886f]">Discount Value</span>
                                                    <span class="font-semibold text-[#111813] dark:text-white">
                                                        <h:outputText value="#{voucher.discountValue}">
                                                            <f:convertNumber type="currency" currencySymbol="â‚«" />
                                                        </h:outputText>
                                                    </span>
                                                </div>

                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-[#63886f]">Expires</span>
                                                    <span class="text-sm text-[#111813] dark:text-white">
                                                        <h:outputText value="#{voucher.expiryDate}"
                                                            rendered="#{voucher.expiryDate != null}">
                                                            <f:convertDateTime pattern="dd/MM/yyyy" timeZone="Asia/Ho_Chi_Minh" />
                                                        </h:outputText>
                                                        <span class="text-gray-500"
                                                            rendered="#{voucher.expiryDate == null}">No expiry</span>
                                                    </span>
                                                </div>

                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm text-[#63886f]">Created</span>
                                                    <span class="text-sm text-[#111813] dark:text-white">
                                                        <h:outputText value="#{voucher.createdAt}">
                                                            <f:convertDateTime pattern="dd/MM/yyyy" />
                                                        </h:outputText>
                                                    </span>
                                                </div>
                                            </div>

                                            <!-- Action Button -->
                                            <div class="mt-4 pt-4 border-t border-[#e5e7eb] dark:border-[#2a3e32]">
                                                <p:commandButton value="Use Voucher"
                                                    disabled="#{!customerVoucherMB.isVoucherValid(voucher)}"
                                                    styleClass="w-full px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 disabled:bg-gray-300 disabled:cursor-not-allowed text-sm font-medium"
                                                    onclick="copyVoucherCode('#{voucher.voucherCode}', '#{voucher.voucherID}'); return false;"
                                                    icon="pi pi-copy">
                                                </p:commandButton>
                                            </div>
                                        </div>
                                    </h:column>
                                </h:dataTable>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h:messages class="fixed bottom-4 right-4 z-50" />
        </h:form>
    </ui:define>
</ui:composition>