<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="/templates/user/layout.xhtml" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="jakarta.faces.facelets" xmlns:h="jakarta.faces.html" xmlns:f="jakarta.faces.core">

    <ui:define name="content">
        <div class="flex-1 w-full max-w-7xl mx-auto px-4 md:px-10 py-8">
            <!-- Breadcrumbs -->
            <nav class="mb-8 overflow-x-auto">
                <div class="flex items-center text-sm font-medium whitespace-nowrap">
                    <h:link class="text-gray-500 hover:text-primary transition-colors"
                        outcome="/pages/user/index.xhtml">Home</h:link>
                    <span class="mx-3 text-gray-400">/</span>
                    <span class="text-primary font-bold">My Orders</span>
                </div>
            </nav>

            <!-- Page Heading -->
            <div class="mb-8">
                <h1 class="text-3xl md:text-4xl font-black tracking-tight text-[#111813] dark:text-white mb-2">
                    My Orders
                </h1>
                <p class="text-gray-500 dark:text-gray-400">View and track your order history</p>
            </div>

            <!-- Filters -->
            <div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-100 dark:border-border-dark p-6 shadow-lg mb-8">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-[#111813] dark:text-white mb-2">
                            Status Filter
                        </label>
                        <h:selectOneMenu value="#{orderHistoryMB.selectedStatus}" class="form-select w-full rounded-lg border border-[#dce5df] dark:border-[#405646] bg-white dark:bg-[#112116] h-12 px-4 text-base">
                            <f:selectItem itemLabel="All Orders" itemValue="all" />
                            <f:selectItem itemLabel="New" itemValue="NEW" />
                            <f:selectItem itemLabel="Processing" itemValue="PROCESSING" />
                            <f:selectItem itemLabel="Shipped" itemValue="SHIPPED" />
                            <f:selectItem itemLabel="Delivered" itemValue="DELIVERED" />
                            <f:selectItem itemLabel="Cancelled" itemValue="CANCELLED" />
                            <f:ajax event="change" execute="@this" render="ordersTable" />
                        </h:selectOneMenu>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-[#111813] dark:text-white mb-2">
                            Search Order ID
                        </label>
                        <h:inputText value="#{orderHistoryMB.searchTerm}" class="form-input w-full rounded-lg border border-[#dce5df] dark:border-[#405646] bg-white dark:bg-[#112116] h-12 px-4 text-base" placeholder="Enter Order ID">
                            <f:ajax event="keyup" execute="@this" render="ordersTable" />
                        </h:inputText>
                    </div>
                </div>
            </div>

            <!-- Orders Table -->
            <div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-100 dark:border-border-dark shadow-lg overflow-hidden">
                <h:dataTable id="ordersTable" value="#{orderHistoryMB.filteredOrders}" var="order" 
                    styleClass="w-full" rowClasses="border-b border-gray-100 dark:border-border-dark hover:bg-gray-50 dark:hover:bg-[#1f332a] transition-colors"
                    headerClass="bg-gray-50 dark:bg-surface-dark text-left text-sm font-semibold text-gray-700 dark:text-gray-200 uppercase tracking-wider"
                    columnClasses="px-6 py-4 whitespace-nowrap">

                    <h:column>
                        <f:facet name="header">Order ID</f:facet>
                        <span class="font-mono font-medium text-primary">##{order.orderID}</span>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Date</f:facet>
                        <span class="text-gray-600 dark:text-gray-400">
                            <h:outputText value="#{order.orderDate}">
                                <f:convertDateTime pattern="MMM dd, yyyy HH:mm" />
                            </h:outputText>
                        </span>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Items</f:facet>
                        <span class="text-gray-600 dark:text-gray-400">#{orderHistoryMB.getOrderItems(order).size()} items</span>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Total</f:facet>
                        <span class="font-bold text-[#111813] dark:text-white">$#{order.totalAmount}</span>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Status</f:facet>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium #{orderHistoryMB.getStatusStyle(order.status)}">
                            #{orderHistoryMB.getStatusDisplay(order.status)}
                        </span>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Actions</f:facet>
                        <h:link outcome="/pages/user/order-detail.xhtml?orderId=#{order.orderID}"
                            class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-lg text-primary bg-primary/10 hover:bg-primary/20 transition-colors">
                            View Details
                        </h:link>
                    </h:column>
                </h:dataTable>

                <h:panelGroup rendered="#{empty orderHistoryMB.filteredOrders}" class="p-12 text-center">
                    <span class="material-symbols-outlined text-gray-400 text-5xl mb-4 block">receipt_long</span>
                    <p class="text-gray-500 dark:text-gray-400 text-lg">No orders found</p>
                    <h:link outcome="/pages/user/index.xhtml" class="mt-4 inline-flex items-center text-primary hover:text-green-600 font-medium transition-colors">
                        Start Shopping
                        <span class="material-symbols-outlined ml-1 text-sm">arrow_forward</span>
                    </h:link>
                </h:panelGroup>
            </div>
        </div>
    </ui:define>
</ui:composition>

