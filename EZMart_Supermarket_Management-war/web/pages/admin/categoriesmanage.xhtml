<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="/templates/admin/layout.xhtml" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="jakarta.faces.html" xmlns:ui="jakarta.faces.facelets" xmlns:f="jakarta.faces.core">

    <ui:define name="content">
        <div class="flex-1 overflow-y-auto p-6 lg:p-10 scroll-smooth">
            <div class="max-w-7xl mx-auto space-y-8">

                <!-- Page Heading -->
                <div class="flex flex-col sm:flex-row sm:items-end justify-between gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-slate-900 dark:text-white">
                            Category Management
                        </h2>
                        <p class="text-slate-600 dark:text-slate-400 mt-1">
                            Organize your product inventory and manage categories
                        </p>
                    </div>

                    <div class="flex gap-3">
                        <button class="inline-flex items-center gap-2 px-4 py-2
                                   bg-slate-100 dark:bg-white/10
                                   hover:bg-slate-200 dark:hover:bg-white/20
                                   text-slate-700 dark:text-slate-300
                                   rounded-lg font-medium transition">
                            <span class="material-symbols-outlined text-lg">download</span>
                            Export Data
                        </button>

                        <h:link outcome="addcategory" class="inline-flex items-center gap-2 px-4 py-2
                                   bg-primary hover:bg-primary/90
                                   text-white rounded-lg font-medium transition">
                            <span class="material-symbols-outlined text-lg">add</span>
                            Add Category
                        </h:link>
                    </div>
                </div>

                <h:form>
                    <!-- Filters -->
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-4">

                        <div class="md:col-span-6">
                            <div class="flex items-center gap-2">

                                <!-- Search input -->
                                <div class="relative flex-1">
                                    <span
                                        class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-[#4e9767]">
                                        search
                                    </span>

                                    <h:inputText value="#{categoryMB.searchTerm}" placeholder="Search category name..."
                                        class="w-full h-11 pl-10 pr-3 rounded-lg
                       bg-white dark:bg-surface-dark
                       shadow-sm focus:ring-2 focus:ring-primary/40" />
                                </div>

                                <!-- Search button -->
                                <h:commandButton value="Search" action="#{categoryMB.searchCategories()}" class="h-11 px-4 bg-primary hover:bg-primary/90
                   text-white rounded-lg font-medium" />

                                <!-- Clear button -->
                                <h:commandButton value="Clear" action="#{categoryMB.loadCategories()}" class="h-11 px-4 bg-slate-100 hover:bg-slate-200
                   text-slate-700 rounded-lg font-medium" />
                            </div>
                        </div>


                        <!-- Status -->
                        <div class="md:col-span-3">
                            <h:selectOneMenu class="w-full h-11 px-3 rounded-lg
                                   bg-white dark:bg-surface-dark
                                   shadow-sm">
                                <f:selectItem itemLabel="All Statuses" itemValue="" />
                                <f:selectItem itemLabel="Active" itemValue="Active" />
                                <f:selectItem itemLabel="Inactive" itemValue="Inactive" />
                            </h:selectOneMenu>
                        </div>
                        <!-- Product Count -->
                        <div class="md:col-span-3">
                            <select class="w-full h-11 px-3 rounded-lg
                                   bg-white dark:bg-surface-dark
                                   shadow-sm">
                                <option>Product Count: Any</option>
                                <option>High (&gt;100)</option>
                                <option>Low (&lt;10)</option>
                                <option>Empty (0)</option>
                            </select>
                        </div>
                    </div>
                </h:form>

                <!-- Table -->
                <h:form>
                    <div class="bg-white dark:bg-surface-dark
                               rounded-xl shadow-sm border overflow-hidden">

                        <table class="min-w-full text-sm">
                            <thead class="bg-[#f8fcf9] dark:bg-white/5">
                                <tr>

                                    <th class="px-6 py-4 text-xs font-semibold uppercase text-gray-500">
                                        ID
                                    </th>
                                    <th class="px-6 py-4 text-xs font-semibold uppercase text-gray-500">
                                        Image
                                    </th>
                                    <th class="px-6 py-4 text-xs font-semibold uppercase text-gray-500">
                                        Category Name
                                    </th>
                                    <th class="px-6 py-4 text-xs font-semibold uppercase text-gray-500">
                                        Description
                                    </th>
                                    <th class="px-6 py-4 text-xs font-semibold uppercase text-gray-500">
                                        Status
                                    </th>
                                    <th class="px-6 py-4 text-xs font-semibold uppercase text-gray-500 text-right">
                                        Actions
                                    </th>
                                </tr>
                            </thead>

                            <tbody class="divide-y">
                                <ui:repeat value="#{categoryMB.paginatedCategories}" var="c">
                                    <tr class="group hover:bg-[#f6f8f6] dark:hover:bg-white/5 transition">

                                        <td class="px-6 py-4 font-mono text-gray-500">
                                            #{c.categoryID}
                                        </td>

                                      <td class="px-6 py-4">
    <div class="flex items-center gap-2">
        <img src="#{request.contextPath}/images/categories/#{c.imageURL}"
             alt="Category Image"
             class="w-8 h-8 rounded object-cover"
             onerror="this.style.display='none'" />

        <span class="text-xs text-gray-400">
            #{c.imageURL != null and c.imageURL != '' ? 'Image' : 'No Image'}
        </span>
    </div>
</td>

                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg
                                                           bg-gray-100 dark:bg-white/10
                                                           flex items-center justify-center">
                                                    <span class="material-symbols-outlined">
                                                        category
                                                    </span>
                                                </div>
                                                <div>
                                                    <p class="font-semibold">
                                                        #{c.categoryName}
                                                    </p>                                               
                                                </div>
                                            </div>
                                        </td>

                                        <td class="px-6 py-4 text-gray-600 truncate max-w-[240px]">
                                            #{c.description}
                                        </td>

                                        <td class="px-6 py-4">
                                            <span class="inline-flex items-center px-2.5 py-0.5
                                                       rounded-full text-xs font-medium
                                                       #{c.status eq 'Active'
                                                         ? 'bg-green-100 text-green-700'
                                                         : 'bg-gray-100 text-gray-600'}">
                                                #{c.status}
                                            </span>
                                        </td>

                                        <td class="px-6 py-4 text-right">
                                            <div class="flex justify-end gap-2">
                                                <h:link outcome="editcategory" class="p-2 rounded-md hover:bg-green-50">
                                                    <f:param name="categoryId" value="#{c.categoryID}" />
                                                    <span class="material-symbols-outlined text-[20px]">
                                                        edit
                                                    </span>
                                                </h:link>

                                                <h:commandLink action="#{categoryMB.deleteCategory(c)}"
                                                    class="p-2 rounded-md hover:bg-red-50">
                                                    <span class="material-symbols-outlined text-[20px]">
                                                        delete
                                                    </span>
                                                </h:commandLink>
                                            </div>
                                        </td>
                                    </tr>
                                </ui:repeat>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="flex items-center justify-between px-6 py-4 bg-slate-50 dark:bg-slate-700/50 border-t border-slate-200 dark:border-slate-700">
                        <div class="text-sm text-slate-600 dark:text-slate-300">
                            Showing #{categoryMB.currentPage * categoryMB.pageSize - categoryMB.pageSize + 1} to
                            #{categoryMB.currentPage * categoryMB.pageSize > categoryMB.totalRecords ? categoryMB.totalRecords : categoryMB.currentPage * categoryMB.pageSize}
                            of #{categoryMB.totalRecords} entries
                        </div>
                        <div class="flex items-center gap-2">
                            <h:commandLink action="#{categoryMB.previousPage()}"
                                disabled="#{categoryMB.currentPage == 1}"
                                styleClass="px-3 py-1 text-sm bg-white dark:bg-slate-600 border border-slate-300 dark:border-slate-500 rounded-md hover:bg-slate-50 dark:hover:bg-slate-500 disabled:opacity-50 disabled:cursor-not-allowed">
                                Previous
                            </h:commandLink>
                            <span class="text-sm text-slate-600 dark:text-slate-300">
                                Page #{categoryMB.currentPage} of #{categoryMB.totalPages}
                            </span>

                            <h:commandLink action="#{categoryMB.nextPage()}"
                                disabled="#{categoryMB.currentPage == categoryMB.totalPages}"
                                styleClass="px-3 py-1 text-sm bg-white dark:bg-slate-600 border border-slate-300 dark:border-slate-500 rounded-md hover:bg-slate-50 dark:hover:bg-slate-500 disabled:opacity-50 disabled:cursor-not-allowed">
                                Next
                            </h:commandLink>
                        </div>
                    </div>
                </h:form>
            </div>
        </div>

         <h:panelGroup id="toastContainer" layout="block"
            styleClass="fixed top-6 left-1/2 -translate-x-1/2 z-50 w-full max-w-md px-4">
            <div class="fixed top-6 left-1/2 -translate-x-1/2 z-50 w-full max-w-md px-4">
                <ui:repeat value="#{facesContext.messageList}" var="msg">
                    <div class="toast-item mb-2 px-6 py-4 rounded-xl shadow-lg text-white
            #{msg.severity == 'INFO' ? 'bg-green-600' :
              msg.severity == 'ERROR' ? 'bg-red-600' :
              msg.severity == 'WARN' ? 'bg-yellow-500 text-black' :
              'bg-blue-600'}">

                        <div class="font-semibold mb-1">
                            #{msg.summary}
                        </div>
                        <div class="text-sm opacity-90">
                            #{msg.detail}
                        </div>
                    </div>
                </ui:repeat>
            </div>
        </h:panelGroup>

        <script>
            document.querySelectorAll('.toast-item').forEach((el, index) => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                    el.style.transition = 'all 0.3s ease';
                }, 100 * index);

                setTimeout(() => {
                    el.style.opacity = '0';
                    el.style.transform = 'translateY(-20px)';
                    setTimeout(() => el.remove(), 300);
                }, 3000);
            });
        </script>
    </ui:define>
</ui:composition>