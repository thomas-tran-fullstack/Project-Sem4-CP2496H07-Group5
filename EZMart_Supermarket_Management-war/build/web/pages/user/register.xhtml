<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="/templates/user/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:h="jakarta.faces.html"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:define name="content">
        <div class="flex min-h-screen w-full bg-white dark:bg-background-dark shadow-xl overflow-hidden rounded-none sm:rounded-none">
            <!-- Left Side: Image / Hero -->
            <div class="hidden lg:flex lg:w-1/2 relative bg-gray-100 items-center justify-center overflow-hidden">
                <img alt="Fresh vegetables and fruits market stall with vibrant colors" class="absolute inset-0 h-full w-full object-cover" data-alt="Fresh vegetables and fruits market stall with vibrant colors" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAXtrHmUxXHMGi_H6do2cpMyMJYGjGzIEIwwAeEWQNbAid-ZamI6BVD-iQqOwaPfJtMwGA-A0udOGByYX4ObdYXgx2vGBIZwnyX9Bkgf4unAsFZAbQpLagexqeddQQOLczHM_-FLbpTJt7-OUBml06esX1lyQZTjrRlqwLHR0uMwYdJ17zxNewvq_2AiUyd2FAmBCaQrv3PlyFa_ihZVuiUW82g6D-C5GsJDfMyIqx7LKkSlPvDW5LFbMVbYxgYq3GZTwPZa2Fi7v4"/>
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"></div>
                <div class="relative z-10 p-12 text-white max-w-xl">
                    <div class="mb-6 flex items-center gap-3">
                        <div class="size-10 bg-primary rounded-lg flex items-center justify-center text-white">
                            <span class="material-symbols-outlined text-2xl">local_mall</span>
                        </div>
                        <h1 class="text-3xl font-bold tracking-tight">EZMart</h1>
                    </div>
                    <h2 class="text-4xl font-bold leading-tight mb-4">Freshness delivered to your doorstep.</h2>
                    <p class="text-lg text-gray-200">Join thousands of happy customers who get their daily essentials delivered fresh and fast.</p>
                    <div class="mt-8 flex gap-4">
                        <div class="flex items-center gap-2 bg-white/10 backdrop-blur-md px-4 py-2 rounded-lg border border-white/20">
                            <span class="material-symbols-outlined text-primary">verified</span>
                            <span class="font-medium">Quality Guarantee</span>
                        </div>
                        <div class="flex items-center gap-2 bg-white/10 backdrop-blur-md px-4 py-2 rounded-lg border border-white/20">
                            <span class="material-symbols-outlined text-primary">local_shipping</span>
                            <span class="font-medium">Free Shipping</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Right Side: Registration Form -->
            <div class="w-full lg:w-1/2 flex flex-col h-screen overflow-y-auto">
                <!-- Mobile Header -->
                <div class="lg:hidden flex items-center justify-between p-6 border-b border-gray-100 dark:border-gray-800">
                    <div class="flex items-center gap-2 text-[#111813] dark:text-white">
                        <div class="size-8 bg-primary/10 rounded-lg flex items-center justify-center text-primary">
                            <span class="material-symbols-outlined text-xl">local_mall</span>
                        </div>
                        <span class="text-lg font-bold">EZMart</span>
                    </div>
                </div>
                <div class="flex-1 flex flex-col justify-center px-6 py-8 sm:px-12 lg:px-20 xl:px-24">
                    <div class="max-w-md w-full mx-auto space-y-8">
                        <!-- Error/Success Messages -->
                        <h:panelGroup layout="block" styleClass="space-y-2">
                            <ui:repeat value="#{facesContext.messageList}" var="msg">
                                <div class="#{msg.severity.ordinal == 2 ? 'bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700 text-red-800 dark:text-red-200' : 'bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700 text-green-800 dark:text-green-200'} rounded-lg p-3 flex items-start gap-3">
                                    <span class="material-symbols-outlined flex-shrink-0 text-sm">#{msg.severity.ordinal == 2 ? 'error' : 'check_circle'}</span>
                                    <span class="text-sm">#{msg.summary}</span>
                                </div>
                            </ui:repeat>
                        </h:panelGroup>

                        <!-- Heading Section -->
                        <div class="text-center sm:text-left">
                            <h2 class="text-3xl font-bold tracking-tight text-[#111813] dark:text-white sm:text-4xl">
                                #{locale.getMessage('register.createAccount')}
                            </h2>
                            <p class="mt-2 text-base text-[#63886f] dark:text-gray-400">
                                #{locale.getMessage('register.haveAccount')} 
                                <h:link class="font-semibold text-primary hover:text-primary-dark transition-colors" value="#{locale.getMessage('register.logIn')}" outcome="login"/>
                            </p>
                        </div>
                        <!-- Social Login -->
                        <div class="grid grid-cols-2 gap-3">
                            <h:form styleClass="contents">
                                <h:commandButton id="google-reg-btn"
                                               action="#{auth.redirectToGoogleOAuth()}"
                                               styleClass="flex items-center justify-center gap-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
                                               value="Google" />
                            </h:form>
                            <button class="flex items-center justify-center gap-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2" type="button">
                                <svg aria-hidden="true" class="h-5 w-5" fill="currentColor" viewbox="0 0 24 24"><path d="M13.2657 2.00018C13.6841 2.00018 14.6549 2.08382 15.6583 2.76637C16.5916 3.39964 17.2941 4.41709 17.2941 5.90018C17.2941 7.21637 16.7916 8.35855 15.8257 9.20018C14.8091 10.0918 13.5999 10.3664 13.0657 10.3664C12.5657 10.3664 11.6649 10.2838 10.7141 9.63382C9.72906 8.95018 9.04406 7.91709 9.04406 6.41709C9.04406 5.06636 9.57739 3.84182 10.5941 2.96636C11.6266 2.08273 12.8657 1.99927 13.2657 2.00018ZM15.4891 11.2338C17.1649 11.2338 18.6324 12.2338 19.3491 13.5671C20.6991 12.0165 22.6157 11.9671 22.8657 11.9671C22.9824 11.9671 23.3324 11.9838 23.3324 12.5002C23.3324 12.6338 23.2824 12.7838 23.2157 12.9002C22.2824 14.5002 22.4157 16.4838 23.5157 17.8171C23.6324 17.9502 23.9491 18.3671 23.9491 18.8838C23.9491 19.0665 23.9157 19.3002 23.7657 19.5338C22.7824 21.0338 21.0324 23.5002 17.6491 23.5002C16.8991 23.5002 16.2991 23.2838 15.6824 23.0671C15.1157 22.8665 14.6157 22.6838 13.9824 22.6838C13.3491 22.6838 12.8324 22.8665 12.2824 23.0671C11.6657 23.2838 11.0491 23.5002 10.3157 23.5002C6.91573 23.5002 5.16573 21.0338 4.18239 19.5338C2.51573 17.0338 2.06573 13.1002 5.09906 11.3338C6.39906 10.5671 7.69906 10.5338 8.44906 10.5338C9.66573 10.5338 10.6324 10.9502 11.3324 11.2671C11.9324 11.5338 12.4491 11.7502 13.1991 11.7502C13.4324 11.7502 14.5991 11.7165 15.4891 11.2338Z"></path></svg>
                                <span class="truncate">Apple</span>
                            </button>
                        </div>
                        <!-- Form -->
                        <h:form class="space-y-5">
                            <div class="relative">
                                <div aria-hidden="true" class="absolute inset-0 flex items-center">
                                    <div class="w-full border-t border-gray-200 dark:border-gray-700"></div>
                                </div>
                                <!-- Username -->
                                <div>
                                    <label class="block text-sm font-medium leading-6 text-[#111813] dark:text-gray-200 mb-1.5" for="username">#{locale.getMessage('register.username')}</label>
                                    <div class="relative">
                                        <h:inputText id="username" value="#{auth.regUsername}" styleClass="form-input block w-full rounded-lg border-0 py-3.5 text-gray-900 shadow-sm ring-1 ring-inset ring-[#dce5df] placeholder:text-[#63886f]/70 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6 dark:bg-gray-800 dark:ring-gray-700 dark:text-white dark:placeholder-gray-500 transition-shadow" />
                                    </div>
                                </div>
                                <div class="relative flex justify-center">
                                    <span class="bg-white dark:bg-background-dark px-2 text-sm text-[#63886f]">#{locale.getMessage('register.orContinueWith')}</span>
                                </div>
                            </div>
                            <!-- First Name -->
                            <div>
                                <label class="block text-sm font-medium leading-6 text-[#111813] dark:text-gray-200 mb-1.5" for="first-name">#{locale.getMessage('register.firstName')}</label>
                                <div class="relative">
                                    <h:inputText id="first-name" value="#{auth.firstName}" styleClass="form-input block w-full rounded-lg border-0 py-3.5 text-gray-900 shadow-sm ring-1 ring-inset ring-[#dce5df] placeholder:text-[#63886f]/70 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6 dark:bg-gray-800 dark:ring-gray-700 dark:text-white dark:placeholder-gray-500 transition-shadow" />
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400">
                                        <span class="material-symbols-outlined text-[20px]">person</span>
                                    </div>
                                </div>
                            </div>
                            <!-- Middle Name -->
                            <div>
                                <label class="block text-sm font-medium leading-6 text-[#111813] dark:text-gray-200 mb-1.5" for="middle-name">#{locale.getMessage('register.middleName')}</label>
                                <div class="relative">
                                    <h:inputText id="middle-name" value="#{auth.middleName}" styleClass="form-input block w-full rounded-lg border-0 py-3.5 text-gray-900 shadow-sm ring-1 ring-inset ring-[#dce5df] placeholder:text-[#63886f]/70 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6 dark:bg-gray-800 dark:ring-gray-700 dark:text-white dark:placeholder-gray-500 transition-shadow" />
                                </div>
                            </div>
                            <!-- Last Name -->
                            <div>
                                <label class="block text-sm font-medium leading-6 text-[#111813] dark:text-gray-200 mb-1.5" for="last-name">#{locale.getMessage('register.lastName')}</label>
                                <div class="relative">
                                    <h:inputText id="last-name" value="#{auth.lastName}" styleClass="form-input block w-full rounded-lg border-0 py-3.5 text-gray-900 shadow-sm ring-1 ring-inset ring-[#dce5df] placeholder:text-[#63886f]/70 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6 dark:bg-gray-800 dark:ring-gray-700 dark:text-white dark:placeholder-gray-500 transition-shadow" />
                                </div>
                            </div>
                            <!-- Email -->
                            <div>
                                <label class="block text-sm font-medium leading-6 text-[#111813] dark:text-gray-200 mb-1.5" for="email">#{locale.getMessage('register.email')}</label>
                                <div class="relative">
                                    <h:inputText id="email" value="#{auth.regEmail}" styleClass="form-input block w-full rounded-lg border-0 py-3.5 text-gray-900 shadow-sm ring-1 ring-inset ring-[#dce5df] placeholder:text-[#63886f]/70 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6 dark:bg-gray-800 dark:ring-gray-700 dark:text-white dark:placeholder-gray-500 transition-shadow" />
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400">
                                        <span class="material-symbols-outlined text-[20px]">mail</span>
                                    </div>
                                </div>
                            </div>
                            <!-- Password Row -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                <div>
                                    <label class="block text-sm font-medium leading-6 text-[#111813] dark:text-gray-200 mb-1.5" for="pwd-field">#{locale.getMessage('register.password')}</label>
                                    <div class="relative">
                                        <h:inputSecret id="pwd-field" value="#{auth.regPassword}" styleClass="form-input block w-full rounded-lg border-0 py-3.5 pr-12 text-gray-900 shadow-sm ring-1 ring-inset ring-[#dce5df] placeholder:text-[#63886f]/70 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6 dark:bg-gray-800 dark:ring-gray-700 dark:text-white dark:placeholder-gray-500 transition-shadow" />
                                        <button id="pwd-toggle-1" class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-auto text-gray-400 hover:text-primary transition-colors" type="button">
                                            <span class="material-symbols-outlined pwd-icon">visibility_off</span>
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium leading-6 text-[#111813] dark:text-gray-200 mb-1.5" for="confirm-password">#{locale.getMessage('register.confirmPassword')}</label>
                                    <div class="relative">
                                        <h:inputSecret id="confirm-password" value="#{auth.regConfirmPassword}" styleClass="form-input block w-full rounded-lg border-0 py-3.5 pr-12 text-gray-900 shadow-sm ring-1 ring-inset ring-[#dce5df] placeholder:text-[#63886f]/70 focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6 dark:bg-gray-800 dark:ring-gray-700 dark:text-white dark:placeholder-gray-500 transition-shadow" />
                                        <button id="pwd-toggle-2" class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-auto text-gray-400 hover:text-primary transition-colors" type="button">
                                            <span class="material-symbols-outlined pwd-icon">visibility_off</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                                <!-- Password Strength Indicator -->
                                <div id="pwd-strength" class="flex items-center gap-1.5 mt-1">
                                    <div id="bar1" class="h-1 flex-1 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
                                    <div id="bar2" class="h-1 flex-1 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
                                    <div id="bar3" class="h-1 flex-1 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
                                    <div id="bar4" class="h-1 flex-1 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
                                    <span id="pwd-strength-label" class="text-xs text-[#63886f] ml-2">&#160;</span>
                                </div>
                            <!-- Checkboxes -->
                            <div class="space-y-4 pt-2">
                                <div class="relative flex items-start">
                                    <div class="flex h-6 items-center">
                                        <input aria-describedby="marketing-description" class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary dark:border-gray-600 dark:bg-gray-700" id="marketing" name="marketing" type="checkbox"/>
                                    </div>
                                    <div class="ml-3 text-sm leading-6">
                                        <label class="font-medium text-[#111813] dark:text-gray-200" for="marketing">#{locale.getMessage('register.keepUpdated')}</label>
                                        <p class="text-[#63886f] dark:text-gray-400" id="marketing-description">#{locale.getMessage('register.emailAbout')}</p>
                                    </div>
                                </div>
                                <div class="relative flex items-start">
                                    <div class="flex h-6 items-center">
                                        <input checked="" class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary dark:border-gray-600 dark:bg-gray-700" id="terms" name="terms" type="checkbox"/>
                                    </div>
                                    <div class="ml-3 text-sm leading-6">
                                        <label class="font-medium text-[#111813] dark:text-gray-200" for="terms">#{locale.getMessage('register.agreeToTerms')} <a class="text-primary hover:underline" href="#">#{locale.getMessage('register.termsOfService')}</a> #{locale.getMessage('register.and')} <a class="text-primary hover:underline" href="#">#{locale.getMessage('register.privacyPolicy')}</a>.</label>
                                    </div>
                                </div>
                            </div>
                            <!-- Submit Button -->
                            <div class="pt-4">
                                <h:commandButton action="#{auth.register}" value="#{locale.getMessage('register.signUp')}" styleClass="flex w-full justify-center rounded-lg bg-primary px-3 py-3.5 text-sm font-bold leading-6 text-white shadow-sm hover:bg-primary-dark focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary transition-all active:scale-[0.98]" />
                            </div>
                        </h:form>
                        <script>//<![CDATA[
                            document.addEventListener('DOMContentLoaded', function() {
                                // Password visibility toggles
                                var toggle1 = document.getElementById('pwd-toggle-1');
                                var toggle2 = document.getElementById('pwd-toggle-2');
                                
                                if(toggle1) {
                                    var pwd1 = document.getElementById('pwd-field');
                                    toggle1.addEventListener('click', function(e) {
                                        e.preventDefault();
                                        var icon1 = toggle1.querySelector('.pwd-icon');
                                        if(pwd1.type === 'password') {
                                            pwd1.type = 'text';
                                            icon1.textContent = 'visibility';
                                        } else {
                                            pwd1.type = 'password';
                                            icon1.textContent = 'visibility_off';
                                        }
                                    });
                                }
                                
                                if(toggle2) {
                                    var pwd2 = document.getElementById('confirm-password');
                                    toggle2.addEventListener('click', function(e) {
                                        e.preventDefault();
                                        var icon2 = toggle2.querySelector('.pwd-icon');
                                        if(pwd2.type === 'password') {
                                            pwd2.type = 'text';
                                            icon2.textContent = 'visibility';
                                        } else {
                                            pwd2.type = 'password';
                                            icon2.textContent = 'visibility_off';
                                        }
                                    });
                                }
                                
                                // Password strength indicator
                                function scorePassword(p){
                                    if(!p) return 0;
                                    var score = 0;
                                    if(p.length >= 8) score++;
                                    if(/[0-9]/.test(p)) score++;
                                    if(/[a-z]/.test(p) && /[A-Z]/.test(p)) score++;
                                    if(/[^A-Za-z0-9]/.test(p)) score++;
                                    return score;
                                }
                                function updateUI(score){
                                    var bars = [document.getElementById('bar1'),document.getElementById('bar2'),document.getElementById('bar3'),document.getElementById('bar4')];
                                    if(!bars[0]) return;
                                    for(var i=0;i<4;i++){
                                        if(i<score){
                                            bars[i].classList.remove('bg-gray-200');
                                            bars[i].classList.remove('dark:bg-gray-700');
                                            bars[i].classList.add('bg-primary');
                                        } else {
                                            bars[i].classList.remove('bg-primary');
                                            bars[i].classList.add('bg-gray-200');
                                            bars[i].classList.add('dark:bg-gray-700');
                                        }
                                    }
                                    var label = document.getElementById('pwd-strength-label');
                                    if(label){
                                        if(score <= 1) { label.textContent = 'Low'; }
                                        else if(score == 2 || score == 3) { label.textContent = 'Medium'; }
                                        else { label.textContent = 'High'; }
                                    }
                                }
                                var pwd = document.getElementById('pwd-field');
                                if(pwd) {
                                    pwd.addEventListener('input', function(e){
                                        var s = scorePassword(e.target.value);
                                        updateUI(s);
                                    });
                                }
                            });
                        //]]></script>
                        <!-- Trust Signals -->
                        <div class="pt-4 flex items-center justify-center gap-2 text-xs text-[#63886f] dark:text-gray-500">
                            <span class="material-symbols-outlined text-[16px]">lock</span>
                            <span>#{locale.getMessage('register.dataSecure')}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ui:define>
</ui:composition>
