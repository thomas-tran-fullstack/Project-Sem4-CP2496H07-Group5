<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="/templates/user/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core">
    <ui:define name="content">

        <div class="max-w-[1280px] mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">
            <!-- Hero Carousel / Banners -->
            <section class="relative w-full rounded-2xl overflow-hidden shadow-lg h-[400px] md:h-[500px]">
                <h:panelGroup rendered="#{homeMB.activeOffers != null and homeMB.activeOffers.size() > 0}">
                    <!-- Carousel Container -->
                    <div class="relative w-full h-full overflow-hidden" id="bannerCarousel">
                        <div class="flex h-full transition-transform duration-1000 ease-in-out" id="carouselTrack" style="width: 100%;">
                            <ui:repeat var="offer" value="#{homeMB.activeOffers}" varStatus="status">
                                <div class="w-full h-full flex-shrink-0 relative"
                                    style="background-image: url('#{request.contextPath}/images/banners/#{offer.bannerImage}'); background-size: cover; background-position: center;">
                                    <div class="absolute inset-0 bg-black/40"></div>
                                    <div class="relative z-10 h-full flex items-center justify-start p-8 md:p-16 max-w-2xl">
                                        <div class="space-y-4">
                                            <span class="inline-block px-4 py-2 text-sm font-bold tracking-wider text-white uppercase bg-primary rounded-full">#{offer.offerType}</span>
                                            <h2 class="text-3xl md:text-5xl font-extrabold text-white leading-tight">#{offer.offerName}</h2>
                                            <p class="text-gray-100 text-base md:text-lg max-w-xl" rendered="#{not empty offer.description}">#{offer.description}</p>
                                            <h:link value="Shop Now â†’" outcome="products" styleClass="inline-block px-8 py-3 bg-white text-primary font-bold rounded-lg hover:bg-gray-100 transition-colors mt-4"/>
                                        </div>
                                    </div>
                                </div>
                            </ui:repeat>
                        </div>

                        <!-- Navigation Arrows -->
                        <button onclick="carouselPrev()" class="absolute left-4 top-1/2 -translate-y-1/2 z-20 bg-white/80 hover:bg-white p-3 rounded-full transition-all" type="button">
                            <span class="material-symbols-outlined text-[24px] text-gray-800">chevron_left</span>
                        </button>
                        <button onclick="carouselNext()" class="absolute right-4 top-1/2 -translate-y-1/2 z-20 bg-white/80 hover:bg-white p-3 rounded-full transition-all" type="button">
                            <span class="material-symbols-outlined text-[24px] text-gray-800">chevron_right</span>
                        </button>

                        <!-- Carousel Indicators -->
                        <div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-20 flex gap-3">
                            <ui:repeat var="offer" value="#{homeMB.activeOffers}" varStatus="status">
                                <button onclick="goToSlide(#{status.index})" class="w-3 h-3 rounded-full bg-white/60 hover:bg-white transition-all" type="button">
                                </button>
                            </ui:repeat>
                        </div>
                    </div>
                </h:panelGroup>
            </section>

            <script>
                let currentSlide = 0;
                let totalSlides = #{homeMB.activeOffers != null ? homeMB.activeOffers.size() : 1};
                let autoPlayInterval;

                function updateCarousel() {
                    const track = document.getElementById('carouselTrack');
                    const carousel = document.getElementById('bannerCarousel');
                    
                    if (track &amp;&amp; carousel) {
                        const offsetPercentage = -currentSlide * 100;
                        track.style.transform = 'translateX(' + offsetPercentage + '%)';
                        
                        // Update indicators
                        const indicators = carousel.querySelectorAll('button[onclick^="goToSlide"]');
                        indicators.forEach((btn, index) => {
                            if (index === currentSlide) {
                                btn.classList.remove('bg-white/60');
                                btn.classList.add('bg-white', 'w-8');
                            } else {
                                btn.classList.add('bg-white/60');
                                btn.classList.remove('bg-white', 'w-8');
                            }
                        });
                    }
                }

                function carouselNext() {
                    currentSlide = (currentSlide + 1) % totalSlides;
                    updateCarousel();
                    resetAutoPlay();
                }

                function carouselPrev() {
                    currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
                    updateCarousel();
                    resetAutoPlay();
                }

                function goToSlide(index) {
                    currentSlide = index;
                    updateCarousel();
                    resetAutoPlay();
                }

                function autoPlay() {
                    currentSlide = (currentSlide + 1) % totalSlides;
                    updateCarousel();
                }

                function resetAutoPlay() {
                    clearInterval(autoPlayInterval);
                    autoPlayInterval = setInterval(autoPlay, 5000);
                }

                // Initialize carousel
                document.addEventListener('DOMContentLoaded', function() {
                    updateCarousel();
                    if (totalSlides > 1) {
                        autoPlayInterval = setInterval(autoPlay, 5000);
                    }
                });
            </script>

            <!-- Categories Section -->
            <section>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Shop by Category</h2>
                    <h:link value="View All" outcome="products" styleClass="text-primary font-bold text-sm hover:underline"/>
                </div>
                <h:panelGroup rendered="#{homeMB.categories != null and homeMB.categories.size() > 0}">
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                        <ui:repeat var="category" value="#{homeMB.categories}">
                            <h:link outcome="products" styleClass="group flex flex-col items-center gap-3 p-4 rounded-xl bg-surface-light dark:bg-surface-dark border border-gray-100 dark:border-gray-800 hover:border-primary/50 hover:shadow-md transition-all">
                                <f:param name="category" value="#{category.categoryID}"/>
                                <div class="w-16 h-16 rounded-full bg-green-50 dark:bg-green-900/20 flex items-center justify-center overflow-hidden">
                                    <img src="#{request.contextPath}/images/categories/#{category.imageURL}" alt="#{category.categoryName}" class="w-full h-full object-cover" />
                                </div>
                                <span class="font-bold text-sm text-center text-gray-700 dark:text-gray-200 group-hover:text-primary">#{category.categoryName}</span>
                            </h:link>
                        </ui:repeat>
                    </div>
                </h:panelGroup>
                <h:panelGroup rendered="#{homeMB.categories == null or homeMB.categories.size() == 0}">
                    <div class="text-center py-12">
                        <p class="text-gray-500 dark:text-gray-400">No categories available</p>
                    </div>
                </h:panelGroup>
            </section>

            <!-- Daily Deals Section -->
            <section>
                <div class="flex items-end justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold tracking-tight text-gray-900 dark:text-white flex items-center gap-2">
                             Daily Deals <span class="text-xl">âš¡</span>
                        </h2>
                        <p class="text-sm text-green-600 dark:text-green-400 mt-1">Offers expire in 04:23:15</p>
                    </div>
                    <div class="flex gap-2">
                        <button class="p-2 rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                            <span class="material-symbols-outlined text-[20px]">chevron_left</span>
                        </button>
                        <button class="p-2 rounded-full border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                            <span class="material-symbols-outlined text-[20px]">chevron_right</span>
                        </button>
                    </div>
                </div>
                <h:panelGroup rendered="#{homeMB.dailyDeals != null and homeMB.dailyDeals.size() > 0}">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <ui:repeat var="product" value="#{homeMB.dailyDeals}">
                            <div class="group bg-white dark:bg-surface-dark rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300 flex flex-col h-full p-5">
                                <!-- Product Image with Link -->
                                <h:link outcome="productdetail" styleClass="block relative aspect-square bg-gray-50 dark:bg-gray-800 overflow-hidden rounded-xl mb-4">
                                    <f:param name="productId" value="#{product.productID}" />
                                    <ui:param name="productImgPath" value="#{homeMB.getProductImageUrl(product)}" />
                                    <img src="#{request.contextPath}#{productImgPath}"
                                        rendered="#{not empty productImgPath}"
                                        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                                        alt="#{product.productName}" />
                                    <div class="w-full h-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-400"
                                        rendered="#{empty productImgPath}">
                                        <span class="material-symbols-outlined text-6xl">image</span>
                                    </div>
                                </h:link>

                                <!-- Product Info -->
                                <div class="flex flex-col flex-grow">
                                    <!-- Product Name -->
                                    <h:link outcome="productdetail" styleClass="block">
                                        <f:param name="productId" value="#{product.productID}" />
                                        <h3 class="font-bold text-gray-900 dark:text-white text-base leading-snug line-clamp-2 mb-2 hover:text-primary transition-colors">#{product.productName}</h3>
                                    </h:link>

                                    <!-- Category and Status -->
                                    <div class="flex gap-2 mb-3">
                                        <span class="text-xs text-gray-500 uppercase font-semibold">#{product.categoryID.categoryName}</span>
                                        <span class="text-xs text-green-600 font-semibold uppercase">In Stock</span>
                                    </div>

                                    <!-- Price Section -->
                                    <div class="mt-auto">
                                        <div class="flex items-baseline gap-2 mb-1">
                                            <span class="text-2xl font-extrabold text-red-600">$<h:outputText value="#{homeMB.getDiscountedPrice(product)}" /></span>
                                            <span class="text-sm text-gray-500 font-medium line-through">$<h:outputText value="#{product.unitPrice}" /></span>
                                        </div>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">#{homeMB.getDiscountDisplay(product)}</p>
                                    </div>
                                </div>
                            </div>
                        </ui:repeat>
                    </div>
                </h:panelGroup>
                <h:panelGroup rendered="#{homeMB.dailyDeals == null or homeMB.dailyDeals.size() == 0}">
                    <div class="text-center py-12">
                        <p class="text-gray-500 dark:text-gray-400">No daily deals available at the moment</p>
                    </div>
                </h:panelGroup>
            </section>

            <!-- Featured Collection -->
            <section class="rounded-2xl bg-surface-light dark:bg-surface-dark p-8 md:p-12 border border-gray-100 dark:border-gray-800">
                <div class="flex flex-col md:flex-row items-center gap-8">
                    <div class="flex-1 space-y-4">
                        <span class="text-primary font-bold tracking-wide uppercase text-sm">Best Sellers</span>
                        <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900 dark:text-white">Pantry Staples<br/>Restocked Daily</h2>
                        <p class="text-gray-600 dark:text-gray-300 max-w-md">From pasta to spices, we ensure your kitchen is always ready for the next meal. Quality guaranteed.</p>
                        <h:link value="Shop Pantry â†’" outcome="products" styleClass="mt-4 px-6 py-3 bg-primary text-white font-bold rounded-lg hover:bg-green-600 transition-colors inline-block"/>
                    </div>
                    <div class="flex-1 w-full relative h-64 md:h-80 rounded-xl overflow-hidden">
                        <img alt="Pantry Items" class="absolute inset-0 w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDegQeW8ByPibbpLSQUO4cSODHTfKzfsISwlCaAMCCR6rlH-x7RsO0eWtS02_YzgD5a7wcfqQX_1wN-aIehtUJdVCnzQRHdrvR7w6rPKLlO4IVU-5BmhbiHpxlJgaEbYhC9VhMgIjaYbngLCKOPPkka_qkl6TD_z3CrqIUEbqpecKUTEUe3Xn0EUvfbPenrEn3ky_a8xeAd6kIYRHcs-XqLWOe9vO0_h2wuPhvJ5ukkmKLi_PmrOu_DFRK1NHxaSJXwohQT6UlNCxA"/>
                    </div>
                </div>
            </section>

            <!-- Why Choose EZMart Section -->
            <section class="rounded-2xl bg-gradient-to-r from-primary/5 to-green-500/5 dark:from-primary/10 dark:to-green-500/10 p-8 md:p-12 border border-primary/10 dark:border-primary/20">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-extrabold text-gray-900 dark:text-white mb-4">Why Choose EZMart?</h2>
                    <p class="text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">We're committed to providing the freshest groceries, exceptional service, and a seamless shopping experience.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-white text-2xl">local_shipping</span>
                        </div>
                        <h3 class="font-bold text-gray-900 dark:text-white mb-2">ðŸšš Free Delivery</h3>
                        <p class="text-gray-600 dark:text-gray-300 text-sm">Free delivery on orders over $50 within 2 hours</p>
                    </div>

                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-white text-2xl">verified</span>
                        </div>
                        <h3 class="font-bold text-gray-900 dark:text-white mb-2">âœ“ Quality Guarantee</h3>
                        <p class="text-gray-600 dark:text-gray-300 text-sm">100% satisfaction guarantee on all products</p>
                    </div>

                    <div class="text-center">
                        <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-white text-2xl">schedule</span>
                        </div>
                        <h3 class="font-bold text-gray-900 dark:text-white mb-2">24/7 Support</h3>
                        <p class="text-gray-600 dark:text-gray-300 text-sm">Round-the-clock customer support for all your needs</p>
                    </div>

                    <div class="text-center">
                        <div class="w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-white text-2xl">eco</span>
                        </div>
                        <h3 class="font-bold text-gray-900 dark:text-white mb-2">â™» Sustainable</h3>
                        <p class="text-gray-600 dark:text-gray-300 text-sm">Eco-friendly packaging and local sourcing</p>
                    </div>
                </div>
            </section>
        </div>
    </ui:define>
</ui:composition>
